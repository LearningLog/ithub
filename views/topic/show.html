<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>document</title>
  <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
  <link rel="stylesheet" href="/public/css/markdown-github.css">
  <style>
    .panel .panel-heading .action i {
      margin-right: 10px;
    }
  </style>
</head>

<body>
  {{include '../_includes/header.html'}}
  <section class="container">
    <div class="row">
      <div class="col-md-9">
        {{ if !topic }}
        <p>此话题不存在或已被删除。</p>
        <a class="btn btn-success" href="/">返回首页</a>
        {{ else }}
        <article class="markdown-body">
          <h1>{{ topic.title }}</h1>
          {{ if topic.userId === sessionUser.id }}
          <a href="/topic/{{ topic.id }}/edit">编辑</a>
          <a href="/topic/{{ topic.id }}/delete" id="delete_topic">删除</a>
          {{ /if }}
          <hr>
          <!-- 
          art-template 为了安全起见，默认是不渲染 HTML 格式的文件，它会帮你原样输出
          如果你希望能输出渲染 HTML，则需要使用一种特殊的模板语法。
         -->
          {{@ topic.content }}
        </article>
        <div class="panel panel-default">
          <div class="panel-heading">
            <span>lipengzhou</span> commented
            <span>24 minutes ago</span>
            <span class="action">
              <a href="">
                <i class="glyphicon glyphicon-thumbs-up pull-right"></i>
              </a>
              <a href="">
                <i class="glyphicon glyphicon-remove-circle pull-right"></i>
              </a>
              <a href="">
                <i class="glyphicon glyphicon-remove-circle pull-right"></i>
              </a>
            </span>
          </div>
          <div class="panel-body">
            评论测试
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <span>lipengzhou</span> commented
            <span>24 minutes ago</span>
            <span class="action">
              <a href="">
                <i class="glyphicon glyphicon-thumbs-up pull-right"></i>
              </a>
              <a href="">
                <i class="glyphicon glyphicon-remove-circle pull-right"></i>
              </a>
              <a href="">
                <i class="glyphicon glyphicon-remove-circle pull-right"></i>
              </a>
            </span>
          </div>
          <div class="panel-body">
            评论测试
          </div>
        </div>
        <hr>
        <form>
          <div class="form-group">
            <label for="exampleInputPassword1">添加回复</label>
            <textarea class="form-control" name="" id="" cols="10" rows="10"></textarea>
          </div>
          <button type="submit" class="btn btn-success">回复</button>
        </form>
        {{ /if }}
      </div>
    </div>
  </section>
  {{include '../_includes/footer.html'}}
  <script src="/node_modules/jquery/dist/jquery.js"></script>
  <script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>
  <script>
    $('#delete_topic').on('click', handleDelete)
    function handleDelete(e) {
      e.preventDefault()
      if (!window.confirm('Are you sure?')) {
        return
      }

      var url = $(this).attr('href')

      $.ajax({
        url: url,
        type: 'get',
        dataType: 'json',
        success: function (data) {
          if (data.code === 200) {
            window.location.href = '/'
          }
        }
      })
    }
  </script>
</body>

</html>